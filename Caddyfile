# Replace with your domain, or use :80 for IP-only access
:80 {
	# Serve uploaded files directly
	handle /uploads/* {
		root * /srv
		file_server
	}

	# Explicit handling for ZKTeco device routes
	handle /iclock/* {
		reverse_proxy app:3000 {
			header_up Host {host}
			header_up X-Real-IP {remote_host}
			header_up X-Forwarded-For {remote_host}
			header_down -X-Accel-Buffering
			header_down X-Accel-Buffering no
			flush_interval -1
		}
	}

	# Proxy everything else
	handle {
		reverse_proxy app:3000
	}
}

# When you have a domain, replace the block above with:
# yourdomain.com {
#     handle /uploads/* {
#         root * /srv
#         file_server
#     }
#     handle {
#         reverse_proxy app:3000
#     }
# }
# Caddy will automatically get and renew HTTPS certificates.
